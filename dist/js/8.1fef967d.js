webpackJsonp([8],{"5Nts":function(t,e){},"5xMQ":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n("n12u"),n("SldL");var s=n("7hDC"),i=n.n(s),o=(n("mJx5"),n("M4fF")),r=n.n(o),a=n("BW2B"),c={name:"feedDetail",components:{HeadTop:a["a"]},data:function(){return{body:"",created_at:"",images:[],comments:[],comments_count:0,liked:!1,likes_count:0,views_count:0,user:{},likesList:[],pinneds:[]}},computed:{bodyWith:function(){return this.$refs.body},feedID:function(){return this.$route.params.feedID},currentUserId:function(){return this.$store.state.CURRENTUSER.id||0},currentUserToken:function(){return this.$store.state.CURRENTUSER.token||""},clientWidth:function(){return this.$refs.content.clientWidth||0},baseUrl:function(){return document.head.querySelector('meta[name="api-basename"]').content},imagesFormat:function(){var t=this;return 0===this.images.length?[]:this.images.map(function(e){var n={},s=r.a.split(e.size,"x"),i=parseInt(s[0])/t.clientWidth;return n.width=t.clientWidth,n.height=parseInt(parseInt(s[1])/i),n.url="".concat(t.baseUrl,"/files/").concat(e.file,"?token=").concat(t.currentUserToken),n})}},methods:{goToUserHome:function(t){this.$router.push("/user/".concat(t))},initData:function(){var t=i()(regeneratorRuntime.mark(function t(){var e,n,s,i,o,r,a,c,d,u;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.get("/feeds/".concat(this.feedID));case 2:e=t.sent,n=e.data,s=n.feed_content,i=n.created_at,o=n.images,r=n.feed_comment_count,a=n.has_like,c=n.like_count,d=n.feed_view_count,u=n.user,this.body=s,this.created_at=i,this.images=o,this.comments_count=r,this.liked=a,this.likes_count=c,this.views_count=d,this.user=u;case 20:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getComments:function(){var t=i()(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.get("/feeds/".concat(this.feedID,"/comments"),{limit:15});case 2:e=t.sent,n=e.data,this.comments=n.comments,this.pinneds=n.pinneds;case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getFeedLikes:function(){var t=i()(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.get("/feeds/".concat(this.feedID,"/likes"),{limit:5});case 2:e=t.sent,n=e.data,this.likesList=n;case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),goBack:function(){this.$router.go(-1)},to:function(t){t="string"===typeof t?{path:t}:t,t&&this.$router.push(t)},likeFeed:function(){var t=this,e=this.liked?"delete":"post",n=this.liked?"/feeds/".concat(this.feedID,"/unlike"):"/feeds/".concat(this.feedID,"/like"),s=this.liked?this.likes_count-1:this.likes_count+1;this.$http({method:e,url:n}).then(function(){t.liked=!t.liked,t.likes_count=s;var e=t.$store.getters.getUserById(t.currentUserId);t.liked?t.likesList.unshift({user:e,user_id:t.currentUserId}):r.a.remove(t.likesList,function(e){return e.user_id===t.currentUserId})})},commentFeed:function(t,e){var n=this;this.$http.post("/feeds/".concat(this.feedID,"/comments"),{body:t,reply_user:e}).then(function(t){var e=t.data;e=void 0===e?{}:e;var s=e.message,i=e.comment;n.comments.unshift(i),n.comments_count+=1,n.$Modal.remove(),n.$Message.success(s)})},commentAction:function(t,e,n){if(t===this.$store.state.CURRENTUSER.id)this.showCommentAction(n);else{var s=e&&t?"回复: ".concat(e):"随便说说";this.showCommentInput({placeholder:s,reply_user:t})}},deleteComment:function(t){var e=this;this.$http.delete("/feeds/".concat(this.feedID,"/comments/").concat(t),{validateStatus:function(t){return 204===t}}).then(function(){e.$Message.success("删除成功"),e.comments_count-=1,r.a.remove(e.comments,function(e){return e.id===t})})},showCommentAction:function(t){var e=this;e.$Modal.info({render:function(n){return n("div",{},[n("button",{on:{click:function(){e.$Modal.remove(),e.deleteComment(t)}}},"删除"),n("button",{on:{click:function(){e.$Modal.remove(),e.$Message.error("还得再等等...")}}},"申请评论置顶")])},onOk:function(){this.$Modal.remove()}})},showCommentInput:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this,n=t,s=n.reply_user;t=Object.assign({},{onOk:function(t){e.commentFeed(t,s)}},t),this.$Modal.commentInpt(t)}},created:function(){this.initData(),this.getFeedLikes(),this.getComments()}},d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"feed-detail"},[n("head-top",{attrs:{"go-back":t.goBack,title:"动态详情"}}),n("div",{staticClass:"ffd-body"},[n("div",{ref:"images",staticClass:"ffd-body-images"},t._l(t.imagesFormat,function(t){return n("img",{key:t.url,attrs:{src:t.url,width:t.width,height:t.height}})})),n("div",{ref:"content",staticClass:"ffd-body-content",domProps:{innerHTML:t._s(t.body)}}),n("div",{staticClass:"ffd-body-foot"},[n("div",{staticClass:"ffd-body-l"},[n("div",{staticClass:"ffd-like-list",class:{"ffd-like-list-none":0===t.likes_count}},t._l(t.likesList,function(t){var e=t.user;return n("div",{key:e.id,staticClass:"ffd-like-list-item"},[n("v-avatar",{key:e.id,attrs:{src:e.avatar,size:"small",sex:e.sex}})],1)})),n("span",[t._v(t._s(t.likes_count)+"人点赞")])]),n("div",{staticClass:"ffd-body-r"},[n("p",[t._v("发布于"+t._s(t._f("time2tips")(t.created_at)))]),n("p",[t._v(t._s(t.views_count)+"人预览")])])])]),n("div",{staticClass:"ffd-foot"},[n("div",{staticClass:"ffd-foot-head"},[t._v("\n      "+t._s(t.comments_count)+"条评论\n    ")]),n("div",{staticClass:"gdf-comment-list"},t._l(t.pinneds,function(e){return n("div",{key:e.id,staticClass:"ffd-comment-item"},[n("router-link",{attrs:{to:"/user/"+e.user.id}},[n("v-avatar",{attrs:{src:e.user.avatar,sex:e.user.sex}})],1),n("div",{staticClass:"ffd-comment-body"},[n("section",{staticClass:"ffd-comment-body-top"},[n("router-link",{attrs:{to:"/user/"+e.user.id,tag:"span"}},[t._v(t._s(e.user.name))]),n("span",[t._v("置顶")]),n("span",[t._v(t._s(t._f("time2tips")(e.created_at)))])],1),e.reply_user?n("section",{staticClass:"ffd-comment-body-reply",on:{click:function(n){n.stopPropagation(),t.commentAction(e.user_id,e.user.name,e.id)}}},[t._v("\n            回复\n            "),n("span",{on:{click:function(n){n.preventDefault(),t.goToUserHome(e.reply.id)}}},[t._v(t._s(e.reply.name))]),t._v(">: \n            "),n("i",{on:{click:function(n){n.stopPropagation(),t.commentAction(e.user_id,e.user.name,e.id)}}},[t._v(t._s(e.body))])]):n("p",{on:{click:function(n){t.commentAction(e.user_id,e.user.name,e.id)}}},[t._v(t._s(e.body))])])],1)})),n("div",{staticClass:"gdf-comment-list"},t._l(t.comments,function(e){return n("div",{key:e.id,staticClass:"ffd-comment-item"},[n("router-link",{attrs:{to:"/user/"+e.user.id}},[n("v-avatar",{attrs:{src:e.user.avatar,sex:e.user.sex}})],1),n("div",{staticClass:"ffd-comment-body"},[n("section",{staticClass:"ffd-comment-body-usually"},[n("router-link",{attrs:{to:"/user/"+e.user.id,tag:"span"}},[t._v(t._s(e.user.name))]),n("span",[t._v(t._s(t._f("time2tips")(e.created_at)))])],1),e.reply_user?n("section",{staticClass:"ffd-comment-body-reply"},[t._v("\n            回复\n            "),n("span",{on:{click:function(n){n.preventDefault(),t.goToUserHome(e.reply.id)}}},[t._v(t._s(e.reply.name))]),t._v(": \n            "),n("i",{on:{click:function(n){n.stopPropagation(),t.commentAction(e.user_id,e.user.name,e.id)}}},[t._v(t._s(e.body))])]):n("p",{on:{click:function(n){t.commentAction(e.user_id,e.user.name,e.id)}}},[t._v(t._s(e.body))])])],1)}))]),n("div",{staticClass:"ffd-action"},[n("div",{staticClass:"ffd-action-item",on:{click:t.likeFeed}},[n("v-icon",{attrs:{type:t.liked?"feed-like":"feed-unlike"}}),n("p",[t._v("喜欢")])],1),n("div",{staticClass:"ffd-action-item",on:{click:t.showCommentInput}},[n("v-icon",{attrs:{type:"feed-comment"}}),n("p",[t._v("评论")])],1),n("div",{staticClass:"ffd-action-item"},[n("v-icon",{attrs:{type:"base-share"}}),n("p",[t._v("分享")])],1),n("div",{staticClass:"ffd-action-item"},[n("v-icon",{attrs:{type:"feed-more"}}),n("p",[t._v("更多")])],1)])],1)},u=[],f=n("XyMi");function l(t){n("5Nts")}var m=!1,h=l,p=null,v=null,_=Object(f["a"])(c,d,u,m,h,p,v);e["default"]=_.exports},ZVc9:function(t,e){},cboG:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("rzQm"),i=n.n(s),o=(n("SldL"),n("7hDC")),r=n.n(o),a=n("XZbU"),c=n("ZoQJ"),d=n("BW2B"),u=n("WCcI"),f=["new","hot","follow"],l={name:"feedIndex",components:{HeadTop:d["a"],FeedItem:a["a"],FootGuide:u["a"]},data:function(){return{feed_type:this.$route.params.type,ad:[],feeds:[],pinned:[],maxId:0}},watch:{$route:function(t){var e=t.params.type;Object(c["f"])(e,f)&&e!==this.feed_type&&(this.ad=[],this.feeds=[],this.pinned=[],this.feed_type=e,this.$nextTick(this.$refs.loadmore.beforeRefresh))}},methods:{onRefresh:function(){var t=r()(regeneratorRuntime.mark(function t(){var e,n,s,o,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.get("/feeds",{params:{type:this.feed_type,limit:15}});case 2:e=t.sent,n=e.data,n=void 0===n?{}:n,s=n.ad,o=n.feeds,r=n.pinned,this.ad=s?i()(s):[],this.feeds=o?i()(o):[],this.pinned=r?i()(r):[],this.maxId=o.length?o[o.length-1].id:0,this.$refs.loadmore.topEnd(!(o.length<15));case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),onLoadMore:function(){var t=r()(regeneratorRuntime.mark(function t(){var e,n,s,o,r,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e={type:this.feed_type,limit:15,after:this.maxId},t.next=3,this.$http.get("/feeds",{params:e});case 3:n=t.sent,s=n.data,s=void 0===s?{}:s,o=s.ad,r=s.feeds,a=s.pinned,this.ad=o?i()(this.ad).concat(i()(o)):this.ad,this.feeds=r?i()(this.feeds).concat(i()(r)):this.feeds,this.pinned=a?i()(this.pinned).concat(i()(a)):this.pinned,this.maxId=r.length?r[r.length-1].id:this.maxId,this.$refs.loadmore.bottomEnd(r.length<15);case 12:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},beforeRouteEnter:function(t,e,n){var s=t.params.type;f.indexOf(s)>-1?n():n({path:"/feed/new"})},beforeDestroy:function(){this.$store.commit("SAVE_FEED_TYPE","")}},m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("head-top",[n("div",{staticClass:"head-top-nav",attrs:{slot:"nav"},slot:"nav"},[n("router-link",{staticClass:"head-top-nav-item",attrs:{to:"/feed/new"}},[t._v("最新")]),n("router-link",{staticClass:"head-top-nav-item",attrs:{to:"/feed/hot"}},[t._v("热门")]),n("router-link",{staticClass:"head-top-nav-item",attrs:{to:"/feed/follow"}},[t._v("关注")])],1)]),n("load-more",{ref:"loadmore",attrs:{onRefresh:t.onRefresh,onLoadMore:t.onLoadMore}},t._l(t.feeds,function(e){return n("feed-item",{key:"feed-"+t.feed_type+"-"+e.id,attrs:{channel:"feed",feed:e}})})),n("foot-guide")],1)},h=[],p=n("XyMi");function v(t){n("ZVc9")}var _=!1,k=v,y=null,g=null,C=Object(p["a"])(l,m,h,_,k,y,g);e["default"]=C.exports}});
//# sourceMappingURL=8.1fef967d.js.map